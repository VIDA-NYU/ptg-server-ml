version: '3'

services:

  detic:
    image: detic
    build:
      context: .
      dockerfile: detic/Dockerfile
    container_name: detic
    volumes:
      - ${VOLUMES}/models/cache:/root/.torch/iopath_cache/detic
      - ${VOLUMES}/models/cache:/root/.cache
      - ${VOLUMES}/models:/src/app/models
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    devices:
     - /dev/nvidia1:/dev/nvidia0
  
  egovlp:
    image: egovlp
    build:
      context: .
      dockerfile: egovlp/Dockerfile
    container_name: egovlp
    #command: -c 'import time;time.sleep(600)'
    volumes:
      - ${VOLUMES}/models/cache:/root/.cache
      - ${VOLUMES}/models:/src/app/models
      - ${VOLUMES}/fewshot:/src/app/fewshot
    environment:
      LOCAL_RANK: '0'
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    devices:
     - /dev/nvidia0:/dev/nvidia0
  
  # actionclip:
  #   image: actionclip
  #   build:
  #     context: .
  #     dockerfile: actionclip/Dockerfile
  #   container_name: actionclip
  #   volumes:
  #     - ${VOLUMES}/models/.cache:/root/.cache
  #     - ${VOLUMES}/models:/src/lib/ptgprocess/models
  #   restart: unless-stopped
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: 1
  #             capabilities: [gpu]
  #   devices:
  #    - /dev/nvidia0:/dev/nvidia0
  
  reasoning:
    build: ./reasoning
    container_name: reasoning
    restart: unless-stopped
    #command: -c 'import time;time.sleep(600)'
    #volumes:
    #  - ${VOLUMES}/models/reasoning:/src/app/models
    #devices:
    # - /dev/nvidia0:/dev/nvidia0

  memory:
    build: ./memory
    container_name: memory
    restart: unless-stopped

  in3d:
    build: ./in3d
    container_name: in3d
    restart: unless-stopped

